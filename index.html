<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... (meglévő head tartalom) ... -->
</head>
<body>
    <!-- ... (meglévő body tartalom) ... -->

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
      import { getFirestore, collection, addDoc, getDocs, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDVahS6mRJVAoMYXuufHzMfu1YZ8GlkV7k",
        authDomain: "point-collector-8f37f.firebaseapp.com",
        projectId: "point-collector-8f37f",
        storageBucket: "point-collector-8f37f.appspot.com",
        messagingSenderId: "381353241547",
        appId: "1:381353241547:web:9a85b70b419c32811ee44e",
        measurementId: "G-3BWW13LHSD"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      async function savePoints(name, phone, euros, date) {
        const points = Math.floor(euros / 10);
        try {
          await addDoc(collection(db, 'points'), {
            name: name,
            phone: phone,
            points: points,
            euros: euros,
            date: date,
            timestamp: new Date()
          });
          console.log('Points saved successfully');
          document.getElementById('point-form').reset();
          fetchPoints();
          fetchTotalPoints();
        } catch (error) {
          console.error('Error saving points: ', error);
        }
      }

      async function fetchPoints() {
        try {
          const q = query(collection(db, 'points'), orderBy('timestamp', 'desc'));
          const querySnapshot = await getDocs(q);
          let pointsList = document.getElementById('points-list');
          pointsList.innerHTML = '';
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const euros = data.euros !== undefined ? data.euros.toFixed(2) : '0.00';
            const date = data.date ? new Date(data.date).toLocaleString() : 'N/A';
            let li = document.createElement('li');
            li.innerHTML = `<strong>${data.name}</strong> - Points: ${data.points} (Euros: ${euros}) - Date: ${date}`;
            pointsList.appendChild(li);
          });
        } catch (error) {
          console.error('Error fetching points: ', error);
        }
      }

      async function fetchTotalPoints() {
        try {
          const q = query(collection(db, 'points'));
          const querySnapshot = await getDocs(q);
          let customerPoints = {};
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const euros = data.euros !== undefined ? data.euros : 0;
            if (customerPoints[data.name]) {
              customerPoints[data.name].points += data.points;
              customerPoints[data.name].euros += euros;
            } else {
              customerPoints[data.name] = { points: data.points, euros: euros };
            }
          });
          updateTotalPoints(customerPoints);
        } catch (error) {
          console.error('Error fetching total points: ', error);
        }
      }

      function updateTotalPoints(customerPoints) {
        let totalPointsDiv = document.getElementById('total-points');
        totalPointsDiv.innerHTML = '<h2><i class="fas fa-chart-bar"></i> Total Points</h2>';
        for (const [name, data] of Object.entries(customerPoints)) {
          const euros = data.euros !== undefined ? data.euros.toFixed(2) : '0.00';
          let div = document.createElement('div');
          div.innerHTML = `<strong>${name}</strong>: ${data.points} points (${euros} EUR)`;
          div.style.margin = '5px';
          div.style.padding = '10px';
          div.style.backgroundColor = '#f0f8ff';
          totalPointsDiv.appendChild(div);
        }
      }

      async function searchCustomer(name) {
        try {
          const q = query(collection(db, 'points'), where('name', '==', name));
          const querySnapshot = await getDocs(q);
          let searchResults = document.getElementById('search-results');
          searchResults.innerHTML = '<table><thead><tr><th>Name</th><th>Phone</th><th>Points</th><th>Euros</th><th>Date</th></tr></thead><tbody></tbody></table>';
          let tbody = searchResults.querySelector('tbody');
          let totalPoints = 0;
          let totalEuros = 0;
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            const euros = data.euros !== undefined ? data.euros.toFixed(2) : '0.00';
            const date = data.date ? new Date(data.date).toLocaleString() : 'N/A';
            let row = document.createElement('tr');
            row.innerHTML = `<td>${data.name}</td><td>${data.phone}</td><td>${data.points}</td><td>${euros}</td><td>${date}</td>`;
            tbody.appendChild(row);
            totalPoints += data.points;
            totalEuros += data.euros;
          });
          let summaryRow = document.createElement('tr');
          summaryRow.innerHTML = `<td colspan="2"><strong>Total</strong></td><td><strong>${totalPoints} points</strong></td><td><strong>${totalEuros.toFixed(2)} EUR</strong></td><td></td>`;
          tbody.appendChild(summaryRow);
        } catch (error) {
          console.error('Error searching customer: ', error);
        }
      }

      document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('point-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          const name = document.getElementById('name').value;
          const phone = document.getElementById('phone').value;
          const euros = parseFloat(document.getElementById('euros').value);
          const date = document.getElementById('date').value;
          await savePoints(name, phone, euros, date);
        });

        document.getElementById('search-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          const name = document.getElementById('search-name').value;
          await searchCustomer(name);
        });

        fetchPoints();
        fetchTotalPoints();
      });

      // Új funkció a fade-in animációhoz
      function fadeIn(element) {
        element.classList.add('fade-in');
      }

      // Azonnal meghívjuk a fadeIn funkciót az összes kártyára
      document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.card').forEach(card => fadeIn(card));
      });
    </script>
</body>
</html>
